# Создание сцены

Для первой сцены добавьте узел Node3D с именем "Hole" и сохраните сцену. Как вы делали в Jungle Jump, вы создадите общую сцену, содержащую все узлы и код, которые будут нужны для любой лункы, а затем унаследуетесь от этой сцены, чтобы создать столько индивидуальных лунок, сколько вам понадобится для игры.

Далее добавьте узел GridMap в сцену.

## Понимание GridMap
GridMap - это трехмерный аналог узла TileMap, который вы использовали ранее в книге. Он позволяет использовать коллекцию сеток (содержащихся в коллекции MeshLibrary - аналогично TileSet) и размещать их в сетке. Поскольку он работает в 3D, вы можете складывать сетки в любом направлении, хотя для этого проекта вы ограничитесь одной плоскостью.

### Создание коллекции MeshLibrary
В папке res://assets/ вы найдете предварительно созданную функцию MeshLibrary под названием golf_tiles.tres, содержащую все необходимые части поля вместе с их формами столкновений.

Чтобы создать свою собственную коллекцию MeshLibrary, вы создадите трехмерную сцену, содержащую отдельные меши, которые вы хотите использовать, добавите к ним коллизии, а затем экспортируете эту сцену в коллекцию MeshLibrary. Если вы откроете golf_tiles.tscn, вы увидите исходную сцену, которая использовалась для создания golf_tiles.tres.

В этой сцене вы увидите все отдельные меши дорожек для мини-гольфа, так как они были импортированы из Blender, где они изначально моделировались. Чтобы добавить формы столкновений к каждому из них, Godot имеет удобную функцию: выберите меш и вы увидите меню Mesh в панели инструментов в верхней части видового окна:

![Меню Mesh](/img/mini-golf/12.jpg)

Выберите "Create Trimesh Static Body", и Godot добавит узел StaticBody3D вместе с узлом CollisionShape3D, используя данные меша.

Когда все коллизии добавлены, вы можете выбрать Сцена -> Экспортировать как -> Библиотека Мешей, чтобы преобразовать сцену в Ресурс, который может использовать GridMap.

## Чертим первую лунку

Перетащите файл библиотеки мешей в свойство **Mesh Library** узла GridMap. Вы увидите список доступных тайлов появится справа от видового окна редактора.

Чтобы соответствовать размеру тайлов, установите **Cell/Size** в (1, 1, 1).

Чтобы убедиться, что столкновения с мячом будут выглядеть хорошо, найдите **Physics Material**  и установите его параметр **Rough** в On и **Bounce** в 0.5:

![Работа с физическим материалом](/img/mini-golf/13.jpg)

Попробуйте нарисовать, выбрав кусок плитки из списка и поместив его на сцену, щелкнув левой кнопкой мыши. Вы можете вращать кусок вокруг оси **y**, нажимая **S**. Чтобы удалить плитку, щелкните правой кнопкой мыши на ней. Пока придерживайтесь простого макета. Вы сможете придумать что-то более замысловатое позже, когда всё будет работать:

![Пример макета](/img/mini-golf/14.jpg)

Вы можете оценить, как это будет выглядеть, когда игра будет запущена. Добавьте функцию Camera3D на сцену и переместите её в позицию, с которой она сможет смотреть на поле сверху. Помните, что вы можете нажать "Предварительный просмотр", чтобы проверить, что видит камера.

Запустите сцену. Вы заметите, что всё очень тёмное, в отличие от того, как это выглядит в окне редактора. По умолчанию в трехмерной сцене не настроены окружающая среда или освещение.

Окружение и освещение
Освещение - это сложная тема сама по себе. Выбор местоположения и настройка освещения могут радикально изменить внешний вид сцены.

Godot предоставляет три узла освещения в 3D:
- OmniLight3D: для света, который излучается во всех направлениях, например, от лампочки
- DirectionalLight3D: свет от дальнего источника, например, солнечного света
- SpotLight3D: конусообразный свет, излучаемый из точки, аналогичный фонарику или фонарю

Помимо размещения отдельных источников света, вы также можете настроить окружающий свет - свет, создаваемый окружающей средой - с помощью узла WorldEnvironment.

Вместо того чтобы начинать с нуля, Godot позволяет вам начать с настройки освещения по умолчанию, которую вы видите в окне редактора, с помощью кнопок на панели инструментов:

![ Настройки освещения и окружения](/img/mini-golf/15.jpg)


Первые две кнопки позволяют включить или выключить предварительный просмотр солнца (направленного света) и окружения. Обратите внимание, что окружение влияет не только на освещение, но и генерирует текстуру неба.

Если вы нажмете на три точки, вы увидите настройки по умолчанию для них. Нажмите кнопку "Добавить", чтобы добавить их в качестве узлов в вашу сцену. Теперь у вас будет узел **WorldEnvironment** и узел **DirectionalLight3D** в вашей сцене.

Если вы увеличите масштаб меша, вы можете заметить, что тени выглядят не очень хорошо. Настройки теней по умолчанию нужно скорректировать, поэтому выберите узел **DirectionalLight3D** и измените максимальное расстояние с 100 на 40.

# Добавление лунки
Теперь, когда у вас есть размеченное поле, вам нужен способ обнаружить, когда мяч попадает в лунку.

Добавьте узел **Area3D** с именем "Hole". Этот узел работает точно так же, как его версия 2D - он может сигнализировать, когда тело входит в его определенную форму. Добавьте дочерний узел CollisionShape3D к области. В свойстве Shape выберите New CylinderShape3D и установите его высоту на 0.25, а радиус на 0.08.

Разместите "Hole" там, где вы разместили плитку лунки на вашем поле. Убедитесь, что цилиндрическая форма не выступает за верх лунки, иначе мяч будет считаться **in(внутри)**, когда он на самом деле еще не упал в нее. Вам может быть полезно использовать кнопку **Perspective (Перспектива)** и переключиться в режим **Top view (Вид сверху)**, чтобы убедиться, что вы правильно центрировали узел:


![Позиционирование лунки](/img/mini-golf/16.jpg)

Также вам нужно отметить стартовую позицию для мяча, поэтому добавьте узел Marker3D с именем "Tee" на сцену. Разместите его там, где вы хотите, чтобы мяч начинал движение. Убедитесь, что вы размещаете его над поверхностью, чтобы мяч не появлялся внутри земли.

С этим завершено создание первого курса. Посмотрите вокруг на несколько минут, чтобы убедиться, что вы довольны макетом. Помните, что это не должен быть сложный или вызывающий сложности макет. Он предназначен для знакомства игрока с игрой, и вы будете использовать его для проверки того, что всё работает правильно позже. Для этого следующим шагом будет создание гольф-мяча.

# Создание мяча
Поскольку мячу нужна физика - гравитация, трение, столкновение с стенами и так далее - *RigidBody3D* будет лучшим выбором узла. Твердые тела работают аналогично в 3D, как вам уже известно из 2D, и вы будете использовать те же методы для взаимодействия с ними, такие как `_integrate_forces()` и `apply_impulse()`.