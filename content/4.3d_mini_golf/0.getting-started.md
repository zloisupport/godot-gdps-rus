
# 3D Minigolf: Dive into 3D by Building a Minigolf

Предыдущие проекты были разработаны в двухмерном пространстве. Это сделано намеренно, чтобы представить возможности и концепции Godot, сохраняя ограниченные масштабы проектов. В этой главе вы погрузитесь в трехмерную сторону разработки игр. Для некоторых трехмерная разработка кажется значительно более сложной для управления. Для других - более простой. В любом случае, непременно имеется дополнительный уровень сложности, который вам предстоит понять.
Если вы никогда не работали с каким-либо трехмерным программным обеспечением раньше, вы можете столкнуться с множеством новых концепций. В этой главе будут объяснены как можно больше из них, но помните обратиться к документации Godot всякий раз, когда вам понадобится более глубокое понимание конкретной темы.
Игра, которую вы создадите в этой главе, называется 3D Мини-гольф. В ней вы построите небольшой мини-гольф-поле, мяч и интерфейс для прицеливания и удара мячом в направлении лунки.
Вот некоторые из вещей, которые вы узнаете в этой главе:


::list
- Навигация в 3D редакторе Godot
- Node3D и его свойства
- Импорт 3D мешей и использование 3D коллизионных форм
- Как использовать 3D камеры
- Настройка освещения и окружения
- Введение в PBR и материалы
::

Прежде чем погружаться, краткое введение в 3D в Godot.



## Введение в 3D

Одним из преимуществ Godot является его способность обрабатывать как 2D, так и 3D игры. Большая часть того, что вы узнали ранее в этой книге, применима также к 3D - узлы, сцены, сигналы и т. д. Но переход от 2D к 3D также вносит новый уровень сложности и возможностей. Сначала вы обнаружите, что в окне редактора 3D доступны дополнительные функции, и полезно ознакомиться с тем, как в нем навигироваться.

## Ориентация в трехмерном пространстве

Откройте новый проект и щелкните по кнопке 3D в верхней части окна редактора, чтобы увидеть вид 3D проекта:

![3D проект](/img/mini-golf/1.jpg)


Рисунок 5.1: Рабочее пространство 3D
Первое, на что вы должны обратить внимание, - это три цветные линии в центре. Это оси x (красная), y (зеленая) и z (синяя). Точка их пересечения - это начало координат, с координатами (0, 0, 0).
3D координаты
Точно так же, как вы использовали Vector2(x, y) для указания позиции в двумерном пространстве, вы будете использовать Vector3(x, y, z), чтобы описать позицию в трех измерениях.
Одна из проблем, которая часто возникает при работе в 3D, заключается в том, что различные приложения используют разные соглашения об ориентации. Godot использует ориентацию Y-UP, поэтому при просмотре осей, если x направлен влево/вправо, то y - вверх/вниз, а z - вперед/назад. Если вы используете другое популярное 3D-программное обеспечение, вы можете обнаружить, что некоторые из них используют Z-Up. Это важно знать, так как это может привести к путанице при переходе между разными программами.
Еще одна важная вещь, о которой стоит знать, - это единица измерения. В двумерном пространстве Godot все измеряется в пикселях, что имеет смысл как естественная единица измерения при рисовании на экране. Однако при работе в трехмерном пространстве пиксели не очень полезны. Два объекта одинакового размера будут занимать разные области на экране в зависимости от того, насколько далеко они находятся от камеры (больше о камерах скоро). По этой причине в трехмерном пространстве все объекты в Godot измеряются в общих единицах. Хотя наиболее распространено называть их "метрами", вы можете называть эти единицы как угодно: дюймы, миллиметры или даже световые годы, в зависимости от масштаба вашего игрового мира.


# Редактор 3D в Godot

Прежде чем слишком углубляться в создание игры, полезно вспомнить, как навигироваться в трехмерном пространстве. Камера просмотра управляется с помощью мыши и клавиатуры:

Колесико мыши вверх/вниз: Приближение/удаление от текущей цели
Средняя кнопка + перетаскивание: Поворот камеры вокруг текущей цели
Shift + средняя кнопка + перетаскивание: Перемещение камеры вверх/вниз/влево/вправо
Правая кнопка + перетаскивание: Поворот камеры на месте

Обратите внимание, что некоторые из этих движений основаны на цели камеры или фокусе. Чтобы сфокусироваться на объекте в пространстве, вы можете выбрать его и нажать F.
Навигация в режиме свободного просмотра
Если вы знакомы с популярными 3D-играми, такими как Minecraft, вы можете нажать Shift + F, чтобы переключиться в режим свободного просмотра. В этом режиме вы можете использовать клавиши W/A/S/D, чтобы перемещаться по сцене, управляя мышью. Нажмите Shift + F снова, чтобы выйти из режима свободного просмотра.
Вы также можете изменить вид камеры, нажав на метку Perspective в верхнем левом углу видового окна. Здесь вы можете привязать камеру к определенной ориентации, такой как Вид сверху или Вид спереди:

![Вид](/img/mini-golf/2.jpg)


Это может быть особенно полезно на больших экранах, особенно при использовании нескольких видовых окон. Щелкните меню "Вид", и вы сможете разделить экран на несколько видов, позволяя видеть объект со всех сторон одновременно.

### Горячие клавиши

Обратите внимание, что каждая из этих опций меню имеет ассоциированные с ней горячие клавиши. Вы можете нажать на "Редактор" -> "Настройки редактора" -> "3D", чтобы просмотреть и настроить горячие клавиши по своему усмотрению.

## Добавление 3D объектов

Пришло время добавить ваш первый 3D узел. Так же как все 2D узлы наследуются от Node2D, который предоставляет свойства, такие как Позиция и Вращение, 3D узлы наследуются от Node3D, который предоставляет пространственные свойства. Добавьте один в сцену, и вы увидите следующее:

![Узел Node3D](/img/mini-golf/3.jpg)

Тот красочный объект, который вы видите, не является узлом, а скорее 3D гизмо. Гизмо - это инструмент, который позволяет перемещать и вращать объекты в пространстве. Три кольца управляют вращением, а три стрелки перемещают объект по трём осям. Обратите внимание, что кольца и стрелки закрашены цветами, соответствующими осям. Стрелки перемещают объект вдоль соответствующей оси, а кольца вращают объект вокруг определенной оси. Также есть три маленьких квадрата, которые фиксируют одну ось и позволяют перемещаться по объекту в плоскости.

Потратьте несколько минут на эксперименты и знакомство с гизмо. Удалите узел и добавьте новый, если заметите, что теряетесь.

Иногда гизмо мешает. Вы можете нажать на значки режима, чтобы ограничить себя только одним типом преобразования: перемещением, вращением или масштабированием:
 
![Выбор режима](/img/mini-golf/4.jpg)

Клавиши Q/W/E/R - это горячие клавиши для этих кнопок, позволяющие быстро переключаться между режимами.

Глобальное пространство по сравнению с локальным пространством
По умолчанию управление гизмо осуществляется в глобальном пространстве. Попробуйте вращать объект - как бы вы его ни поворачивали, стрелки перемещения гизмо всё еще указывают вдоль глобальных осей. Теперь попробуйте следующее: верните узел Node3D в его первоначальное положение и ориентацию (или удалите его и добавьте новый). Поверните объект вокруг одной оси, а затем щелкните кнопку Использовать локальное пространство (обратите внимание на горячую клавишу T):

![Переключение режима локального пространства](/img/mini-golf/5.jpg)

Обратите внимание на стрелки гизмо. Теперь они указывают вдоль локальных осей объекта, а не глобальных осей мира. Когда вы щелкаете и перетаскиваете стрелки, они перемещают объект относительно его собственного вращения. Вы можете вернуться к глобальному пространству, щелкнув кнопку снова. Переключение между этими двумя режимами может значительно облегчить размещение объекта именно там, где вы хотите.

## Преобразования
Посмотрите на Инспектор для узла Node3D. В разделе Трансформации вы увидите свойства Позиции, Вращения и Масштаба узла. По мере перемещения объекта вы увидите изменение этих значений. Так же, как и в 2D, эти значения относятся к родительскому узлу.

Эти три величины составляют свойство трансформации узла. При изменении пространственных свойств узла в коде вы имеете доступ к его свойству трансформации, которое является объектом Godot Trans form3D. Transform3D имеет два подсвойства: origin и basis. Свойство origin представляет собой позицию тела, в то время как свойство basis содержит три вектора, которые определяют локальные координатные оси тела. Подумайте о трех стрелках осей в гизмо, когда вы находились в режиме Локального Пространства.

Вы увидите, как использовать эти свойства позже в этом разделе.

## Меши
Точно так же, как узел Node2D, узел Node3D не имеет собственного размера или внешнего вида. В 2D вы добавляли Sprite2D для отображения текстуры, присоединенной к узлу. В 3D вам, как правило, захочется добавить меш. Меш - это математическое описание трехмерной формы. Он состоит из набора точек, называемых вершинами. Эти вершины соединены линиями, называемыми ребрами, и несколько ребер (по крайней мере, три) вместе образуют грань.
Куб, например, состоит из восьми вершин, двенадцати ребер и шести граней:

![ Вершины, рёбра и грани](/img/mini-golf/6.jpg)

Если вы когда-либо использовали программное обеспечение для 3D-моделирования, это может вам уже быть знакомо. Если нет, и вы заинтересованы в изучении 3D-моделирования, Blender - очень популярный инструмент с открытым исходным кодом для создания 3D-объектов. Вы можете найти множество уроков и уроков в интернете, чтобы помочь вам начать работу с Blender.

## Примитивы
Если у вас еще нет созданных или загруженных 3D-моделей, или если вам просто нужна простая форма быстро, Godot имеет возможность создавать определенные 3D-меши непосредственно. Добавьте узел MeshInstance3D в качестве дочернего к вашему узлу Node3D, и в Инспекторе найдите свойство Mesh:

![ Добавление нового меша](/img/mini-golf/7.jpg)

Эти заранее определенные формы называются примитивами и представляют собой удобный набор общих и полезных форм.

Выберите New BoxMesh, и вы увидите куб на экране.

## Импорт мешей

Какое бы программное обеспечение для моделирования вы ни использовали, вам нужно будет экспортировать свои модели в формат, который можно прочитать в Godot.

Godot поддерживает ряд форматов файлов для импорта:
`
giTF - supported in both text (.gltf) and binary (. glb ) versions
dae (collada) - an old format that is still supported
OBJ (Wavefront) - supported, but limited due to the format limitations ESCN - a Godot-specific file format that Blender can export
FBX - a commercial format that has limited support
`

Рекомендуемый формат - .gltf. Он имеет наибольший набор функций и отлично поддерживается в Godot. Смотрите приложение для получения подробной информации о экспорте файлов .gltf из Blender для использования в Godot.

Далее в этой главе вы увидите, как импортировать некоторые предварительно созданные сцены .gltf.

## Камеры
Попробуйте запустить сцену со своим мешем куба. Где он? В 3D вы не увидите ничего в игровом видовом окне, если в сцене нет камеры Camera3D. Добавьте одну, и вы увидите новый узел, который выглядит так:

![Виджет камеры](/img/mini-golf/8.jpg)

Используйте гизмо камеры, чтобы расположить ее немного выше и направить на куб:

![Нацеливание камеры](/img/mini-golf/9.jpg)

Розово-пурпурный, пирамидальный объект называется фрустумом камеры. Он представляет собой вид камеры и может быть сделан узким или широким, чтобы влиять на угол обзора камеры. Треугольная форма в верхней части фрустума указывает на направление "вверх" камеры.

Пока вы перемещаете камеру, вы можете нажать кнопку "Предварительный просмотр" в правом верхнем углу видового окна, чтобы проверить, что видит камера. Пробуйте экспериментировать с позиционированием камеры и изменением её поля зрения (FOV).

## Ориентация

Обратите внимание, что фрустум камеры смотрит вдоль оси -Z. Это направление вперёд в трехмерном пространстве Godot. Например, это то, что вы бы сделали, если бы хотели переместить 3D объект вдоль его локальной передней оси, где transform.basis это локальный набор осей объекта:

`gscript
position += -transform.basis.z * speed * delta
`

Эти новые концепции и функции редактора помогут вам навигировать и работать в трехмерном пространстве. Обратитесь к этому разделу, если вам нужно напоминание о значении какого-либо конкретного термина, связанного с 3D. В следующем разделе вы начнёте настройку своего первого 3D проекта.