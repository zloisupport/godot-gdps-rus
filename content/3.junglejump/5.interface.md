

# Интерфейс игры

Как и в предыдущих проектах, нам понадобится элемент управления (HUD), чтобы отображать информацию во время игры. Сбор предметов будет увеличивать счет игрока, поэтому этот показатель также должен отображаться, а также оставшееся количество жизней игрока, которое будет представлено в виде серии сердец.

Настройка сцены
Создайте новую сцену с корневым узлом **MarginContainer** и именем HUD. Сохраните ее в новой папке с именем ui. Установите макет (Layout) в Top Wide, а в разделе Theme Overrides/Constants в инспекторе установите правые и левые поля на 50, а верхние/нижние поля на 20.

Добавьте узел HBoxContainer для выравнивания элементов и добавьте два дочерних узла, **Label** и **HBoxContainer**, с именами Score и LifeCounter, соответственно.

Для метки Score установите свойство **Text** в **100**. В инспекторе, в разделе **Layout/Container Sizing**, отметьте флажок Expand. В настройках Label добавьте новый объект настройки для настройки шрифта. Перетащите res://assets/Kenney Thick.ttf в свойство Font и установите размер шрифта (Size) в 48. В разделе Outline установите Size на 16, а Color на черный. Вы должны увидеть число 100, отображенное белым цветом с черным контуром.

Для LifeCounter добавьте дочерний узел **TextureRect** и назовите его L1. Перетащите res://assets/heart.png в область Texture и установите Stretch Mode в Keep Aspect Centered. Выберите L1 и продублируйте (Ctrl + D) его четыре раза, чтобы у вас был ряд из пяти сердец:


![HUD ](/img/jungle-jump/B19289_04_22.jpg)

Когда вы закончите, ваш HUD должен выглядеть примерно так:

![HUD preview](/img/jungle-jump/B19289_04_23.jpg)

Следующим шагом будет добавление скрипта, чтобы HUD мог обновляться во время игры.

# Скрипт для HUD
Этот скрипт требует две функции, которые могут быть вызваны для обновления двух отображаемых значений:

```gdscript
extends MarginContainer
@onready var life_counter = $HBoxContainer/LifeCounter.get_children()
func update_life(value):
    for heart in life_counter.size():
        life_counter[heart].visible = value > heart
func update_score(value):
    $HBoxContainer/Score.text = str(value)
```

Обратите внимание, что в функции update_life() вы рассчитываете количество сердец для отображения, устанавливая visible в false, если номер этого сердца меньше количества жизней.


# Добавляем HUD
Откройте level_base.tscn (основную сцену уровня, а не вашу сцену Level01) и добавьте CanvasLayer. Добавьте экземпляр HUD в качестве дочернего элемента этого CanvasLayer.

Выберите экземпляр Player уровня и подключите его сигнал life_changed к методу update_life HUD:


![Подкл сигнал](/img/jungle-jump/B19289_04_24.jpg)

Сделайте то же самое с сигналом **score_changed узла Level**, подключив его к методу **update_score()** HUD.

Обратите внимание, что если вы не хотите использовать дерево сцен для подключения сигналов, или если вы считаете, что окно подключения сигналов запутано или труднопонимаемо, вы можете выполнить тоже самое в своем скрипте, добавив эти строки в функцию _ready() в level.gd:

```gdscript
$Player.life_changed.connect($CanvasLayer/HUD.update_life)
score_changed.connect($CanvasLayer/HUD.update_score)
```

Запустите игру и убедитесь, что вы видите HUD и он обновляется правильно. Убедитесь, что вы собираете предметы и позволяете врагу вас ударить. Увеличивается ли ваш счет? При ударе лишаетесь одной жизни? После проверки этого вы можете перейти к следующему разделу и создать экран заголовка.

# Экран заголовка

Экран заголовка - это то, что игрок увидит первым, и игра вернется на этот экран, когда игрок умрет и игра закончится.

# Настройка сцены

Начните с узла Control и установите макет (Layout) на Full Rect. Добавьте узел TextureRect, используя изображение back.png. Установите макет (Layout) на Full Rect и режим растяжения (Stretch Mode) на Keep Aspect Covered.

Добавьте еще один TextureRect, на этот раз используя middle.png и установив режим растяжения (Stretch Mode) на Tile. Растяните ширину прямоугольника до тех пор, пока он не будет шире экрана, и расположите его так, чтобы он покрывал нижнюю половину.

Добавьте два узла Label с именами Title и Message и установите их свойства Text соответственно на Jungle Jump и Press Space to Play. Добавьте шрифт к каждому, как вы уже делали ранее, установив размер 72 для заголовка и размер 48 для сообщения. Установите макет (layout) для заголовка на Centered, а для сообщения - на Center Bottom.

Когда закончите, сцена должна выглядеть примерно так:
![Экран заголовка](/img/jungle-jump/B19289_04_25.jpg)


Для того чтобы сделать экран заголовка более интересным, добавьте к нему узел AnimationPlayer. Создайте новую анимацию с именем intro и установите ее на автовоспроизведение. В этой анимации вы можете анимировать элементы экрана, чтобы они двигались, появлялись, затухали и т. д.

Например, добавьте ключевую точку для текущей позиции заголовка (Title) в момент времени 0.5. Затем, в момент времени 0, перетащите заголовок за верхний край экрана и добавьте еще одну ключевую точку. Теперь, при воспроизведении сцены, заголовок упадет на экран.

Не стесняйтесь добавлять дорожки, анимирующие свойства других узлов. Например, вот анимация, которая опускает заголовок вниз, затем затухает две текстуры, а затем появляется сообщение:

![Экран заголовка анимация](/img/jungle-jump/B19289_04_26.jpg)

Экран заголовка был оставлен простым, но вы можете добавить к нему что-то по своему вкусу. Вы можете показать пример каких-то платформ, добавить анимацию персонажа, бегущего по экрану, или какое-то другое игровое искусство. Но что произойдет, когда игрок нажмет "старт"? Для этого вам нужно загрузить первый уровень в основной сцене.

# Настройка основной сцены
Вы создали несколько сцен уровней, но, в конечном итоге, вам захочется создать больше одного. Как игра узнает, какой уровень загрузить? За это будет отвечать ваша основная сцена.

Удалите все дополнительные узлы, которые вы добавили в main.tscn, когда тестировали движение игрока. Теперь эта сцена будет отвечать за загрузку текущего уровня. Однако, прежде чем она сможет это сделать, вам нужен способ отслеживать текущий уровень. Вы не можете отслеживать эту переменную в сцене уровня, потому что она будет заменена новым загруженным уровнем, когда он завершится. Для отслеживания данных, которые необходимо передавать из сцены в сцену, вы можете использовать автозагрузку.



# Об автозагрузке

В Godot вы можете настроить сценарий или сцену как автозагрузку. Это означает, что движок будет автоматически загружать ее всегда. Даже если вы измените текущую сцену в SceneTree, автозагруженный узел останется. Вы также можете обращаться к этой автозагруженной сцене по имени из любого другого узла в вашей игре.

В редакторе сценариев создайте новый сценарий с именем game_state.gd и добавьте следующий код:
```gdscript
extends Node
var num_levels = 2
var current_level = 0
var game_scene = "res://main.tscn"
var title_screen = "res://ui/title.tscn"
func restart():
    current_level = 0
    get_tree().change_scene_to_file(title_screen)
func next_level():
    current_level += 1
    if current_level <= num_levels:
        get_tree().change_scene_to_file(game_scene)
```


Вы должны установить значение num_levels равным количеству уровней, которые вы создали в папке levels. Убедитесь, что вы даете им согласованные имена, такие как level_01.tscn, level_02.tscn и так далее, чтобы их можно было легко найти.

Чтобы добавить этот сценарий как автозагрузку, откройте Настройки проекта и найдите вкладку Autoload. Нажмите на значок папки, чтобы выбрать game_state.gd, а затем нажмите кнопку Add.

Затем добавьте этот сценарий в вашу основную Main сцену:

```gdscript
extends Node
func _ready():
    var level_num = str(GameState.current_level).pad_zeros(2)
    var path = "res://levels/level_%s.tscn" % level_num
    var level = load(path).instantiate()
    add_child(level)
```


Теперь, когда основная сцена загружается, она будет включать сцену уровня, соответствующую текущему уровню.

Этот скрипт должен быть присоединен к узлу Title, чтобы экран заголовка мог переходить к игровой сцене:

```gdscript
extends Control

func _input(event):
    if event.is_action_pressed("ui_select"):
        GameState.next_level()
```

Наконец, чтобы вызвать функцию restart() при смерти игрока, добавьте ее в level.gd. В сцене Level подключите сигнал died экземпляра Player:

```gdscript
func _on_player_died():
    GameState.restart()
```

Теперь вы должны быть в состоянии полностью пройти игру. Убедитесь, что title.tscn установлена как основная сцена игры (то есть та, которая запускается первой). Если ранее была установлена другая сцена как "основная" сцена, вы можете изменить это в Настройках проекта в разделе Приложение/Запуск:

![Cмена основной сцены](/img/jungle-jump/B19289_04_27.jpg)


# Transitioning between levels
Теперь у ваших уровней должен быть способ перехода от одного к другому. В спрайт-листе res://assets/environment/props.png есть изображение двери, которое вы можете использовать для выхода из уровня. Нахождение и прохождение через дверь перенесет игрока на следующий уровень.